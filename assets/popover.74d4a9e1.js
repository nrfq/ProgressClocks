import{O as h,g as m}from"./getPluginId.5b24b4d0.js";import{D as T,r as d,Z as b,d as o,ah as y,a0 as P,aF as M,$ as I,aK as w,a5 as C,ak as g,aw as R,a3 as S,j as f,ao as B,az as N,aA as A,aB as O,aC as _,aD as k,aE as z,aJ as F,ag as G,aN as D,aI as j,aO as X,aP as H,aQ as W,aM as Z}from"./PluginThemeProvider.ffcdfbf9.js";function V({rollTransforms:t}){const{invalidate:n}=T(),s=d.exports.useMemo(()=>{if(t){const c=Object.values(t);if(c.length>0){const r=J(c),u=Math.max(r.width,r.height),i=Math.min(.8,Math.max(-.8,r.center.x)),e=K(1,3,Math.max(Math.min(u,1),0)),l=Math.min(.8,Math.max(-.8,r.center.y));return[i,e,l]}else return[0,3,0]}else return[0,3,0]},[t]),{position:a}=b({position:s,onChange:()=>n(),config:I.slow});return o(y,{children:o(P.group,{position:a,children:o(M,{makeDefault:!0,fov:28,rotation:[-Math.PI/2,0,0]})})})}function J(t){let n=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER;for(let e of t)n=e.position.x<n?e.position.x:n,s=e.position.x>s?e.position.x:s,a=e.position.z<a?e.position.z:a,c=e.position.z>c?e.position.z:c;let r=s-n,u=c-a,i={x:(n+s)/2,y:(a+c)/2};return{min:{x:n,y:a},max:{x:s,y:c},width:r,height:u,center:i}}function K(t,n,s){return t*(1-s)+n*s}function L({player:t,onToggle:n,onOpen:s}){const{diceRoll:a,finalValue:c,finishedRolling:r,finishedRollTransforms:u}=w(t),i=C(),e=!a||a.hidden,[l,p]=d.exports.useState(r);d.exports.useEffect(()=>{if(r){const E=setTimeout(()=>{p(!0)},5e3);return()=>{clearTimeout(E)}}else p(!1)},[r]);const x=!e&&!l;d.exports.useEffect(()=>{x&&n(t.connectionId,!0)},[x]);function v(){x&&(p(!0),s(t.connectionId))}return o(g,{component:"div",position:"absolute",right:16,bottom:16,children:o(R,{in:x,onExited:()=>n(t.connectionId,!1),direction:"up",children:o(S,{onClick:v,children:f(B,{elevation:8,sx:{width:"250px",height:"282px",borderRadius:2,overflow:"hidden",backgroundColor:i.palette.mode==="dark"?"rgba(34, 38, 57, 0.8)":"rgba(255, 255, 255, 0.4)"},children:[o(g,{component:"div",height:"250px",width:"250px",children:o(N,{children:o(A,{frameloop:"demand",children:f(O,{volume:.25,children:[o(_,{files:k}),o(z,{}),o(F,{player:t}),o(V,{rollTransforms:r?u:void 0})]})})})}),f(G,{variant:"subtitle1",color:"text.secondary",textAlign:"center",lineHeight:"32px",sx:{bgcolor:"background.default"},noWrap:!0,children:[t==null?void 0:t.name,r&&f("span",{children:[" | ",c]})]})]})})})})}function Q(){const[t,n]=d.exports.useState([]);d.exports.useEffect(()=>{h.party.getPlayers().then(n)},[]),d.exports.useEffect(()=>h.party.onChange(n),[]);const[s,a]=d.exports.useState([]);d.exports.useEffect(()=>{const i=t.map(e=>e.connectionId);a(e=>e.filter(l=>i.includes(l)))},[t]);function c(i,e){a(e?l=>l.includes(i)?l:[...l,i]:l=>l.filter(p=>p!==i))}function r(i){if(window.BroadcastChannel){h.action.open();const e=new BroadcastChannel(m("focused-tray"));e.postMessage(i),e.close()}}const u=s.length===0;return d.exports.useEffect(()=>{u?(h.popover.setHeight(m("popover"),0),h.popover.setWidth(m("popover"),0)):(h.popover.setHeight(m("popover"),298),h.popover.setWidth(m("popover"),266))},[u]),o(g,{component:"div",position:"absolute",bottom:"0",left:"0",right:"0",top:"0",overflow:"hidden",children:t.map(i=>o(L,{player:i,onToggle:c,onOpen:r},i.connectionId))})}D.createRoot(document.getElementById("root")).render(o(j.StrictMode,{children:f(X,{children:[o(H,{}),o(W,{}),o(Z,{children:o(Q,{})})]})}));
